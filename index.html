<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Originality Cirtificate</title>
  <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
  <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">-->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="index.css" type="text/css">
  
</head>

<body>
  <div class='background middle'>
    <div class='middle'>
      <span id='ageHide'>How old are you?<br><input type="text" id='ageAnswer'><br><br><button class='age'>Submit</button><br><br></span>
      <span id='colorHide'>What is your favorite color?<br><input type="text" id='colorAnswer'><br><br><button class='color'>Submit</button><br><br></span>
      <span id='ethnicityHide'>What is your ethnicity?<br><input type="text" id='ethnicityAnswer'><br><br><button class='ethnicity'>Submit</button><br><br></span>
    </div>
  </div>

  <script>
    var answerValue2
    var answerValue
    var count = 0
    var length
    
    $('#colorHide').hide()
    $('#ethnicityHide').hide()

    function getData(data){
      var query = firebase.database().ref(data).orderByKey();
      query.once("value")
        .then(function(snapshot) {
          snapshot.forEach(function(childSnapshot) { //for each is a loop!!
            // childData will be the actual contents of the child
            var childData = childSnapshot.val();
            var objects = (Object.values(childData))

            if (answerValue == objects[0]){
              count ++
            }
        });
      });
    }
    
    function getValue(val){
      answerValue2 = document.getElementById(val).value
      answerValue = answerValue2.trim()
    }
    
    $('.age').click(function() {
      getValue('ageAnswer')
      answerValue = parseInt(answerValue)
      if (answerValue === parseInt(answerValue)){
        writeAgeData(answerValue)
        getData('age/')
        setTimeout(function(){
          if (count<=1){
            alert('You are the only person surveyed that is ' +answerValue+ ' years old!')
          }
          else{
            alert(count + ' people surveyed are the same age as you!')
          }
          $('#ageHide').hide()
          $('#colorHide').show()
        }, 1500);
      }
      else{
        alert('Please type a number!')
      }
    });
    
    $('.color').click(function() {
      getValue('colorAnswer')
      if (answerValue==''){
        alert('Please type word(s)!')
      }
      else{
        writeColorData(answerValue)
        getData('color/')
        setTimeout(function(){
          if (count<=1){
            alert('You are the only person surveyed that is ' +answerValue)
          }
          else{
            alert(count + ' people surveyed have the same ethnicity as you!')
          }
          $('#colorHide').hide()
          $('#ethnicityHide').show()
        }, 1500);
      }
    });
    
    $('.ethnicity').click(function() {
      getValue('ethnicityAnswer')
      if (answerValue==''){
        alert('Please type word(s)')
      }
      else{
        writeEthnicityData(answerValue)
        getData('ethnicity/')
        setTimeout(function(){
          if (count<=1){
            alert('You are the only person surveyed that has the favorite color ' +answerValue)
          }
          else{
            alert(count + ' people surveyed have the same favorite color as you!')
          }
          $('#ethnicityHide').hide()
        }, 1500);
      }
    });
    
  </script>

  <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyACSL_vfuK6_ff6gwU22MIpVeNEunAGIXs",
      authDomain: "generator-project1.firebaseapp.com",
      databaseURL: "https://generator-project1.firebaseio.com",
      projectId: "generator-project1",
      storageBucket: "generator-project1.appspot.com",
      messagingSenderId: "114613586829"
    };
    firebase.initializeApp(config);

    var database = firebase.database();

    function writeAgeData(ageValue) {
      firebase.database().ref('age/').push().set({
        value: ageValue
      });
    }

    function writeColorData(colorValue) {
          firebase.database().ref('color/').push().set({
            value:colorValue
          });
    }

    function writeEthnicityData(ethnicityValue) {
          firebase.database().ref('ethnicity/').push().set({
            value:ethnicityValue
          });
    }
  </script>
</body>

</html>